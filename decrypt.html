<!DOCTYPE html>
<html>

<head>
  <meta charset="UTF-8">
  <title>File Decryptor</title>
  <link rel="stylesheet" type="text/css" href="decrypt.css">
</head>

<body>
  <header>
    <nav>
      <a href="index.php">Home</a>
      <a href="encrypt.html">Encrypt</a>
      <a href="decrypt.html">Decrypt</a>
    </nav>
    <a href="login.html">Log Out</a>
  </header>
  <div class="container">
    <h1>AES IMAGE ENCRYPTION SYSTEM</h1>
    <h2>File Decryptor</h2>
    <form>
      <label for="encrypted-file">Select an encrypted file to decrypt:</label>
      <input type="file" id="encrypted-file" accept=".enc">
      <label for="password">Enter the decryption password:</label>
      <input type="password" id="password">
      <button id="decrypt-btn">Decrypt</button>
      <p class="error" id="error"></p>
    </form>
  </div>
  <script>
    const decryptBtn = document.getElementById('decrypt-btn');
    const encryptedFileInput = document.getElementById('encrypted-file');
    const passwordInput = document.getElementById('password');
    const errorElem = document.getElementById('error');

    decryptBtn.addEventListener('click', () => {
        // Validate that an image and password have been provided
        if (!encryptedImageInput.value) {
          showError('Please select an encrypted image to decrypt.');
          return;
        }
        if (!passwordInput.value) {
          showError('Please enter the decryption password.');
          return;
        }
        
        // Read the encrypted image file
        const reader = new FileReader();
        reader.readAsDataURL(encryptedImageInput.files[0]);
        reader.onload = () => {
          const encryptedImageData = reader.result.split(',')[1]; // Extract the base64-encoded data
          
          // Decrypt the image using the password and AES algorithm
          const key = CryptoJS.enc.Utf8.parse(passwordInput.value);
          const decryptedData = CryptoJS.AES.decrypt(encryptedImageData, key, { mode: CryptoJS.mode.ECB, padding: CryptoJS.pad.Pkcs7 });
          const decryptedImage = new Blob([decryptedData], { type: encryptedImageInput.files[0].type });
          
          // Create a URL for the decrypted image
          const decryptedImageUrl = URL.createObjectURL(decryptedImage);
          
          // Display the decrypted image to the user
          const imgElem = document.createElement('img');
          imgElem.src = decryptedImageUrl;
          document.body.appendChild(imgElem);
        };
      });

    function showError(errorMessage) {
      errorElem.innerText = errorMessage;
    }
  </script>
</body>

</html>