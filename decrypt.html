<!DOCTYPE html>
<html>

<head>
  <meta charset="UTF-8">
  <title>File Decryptor</title>
  <link rel="stylesheet" type="text/css" href="decrypt.css">
</head>

<body>
  <header>
    <nav>
      <a href="index.html">Home</a>
      <a href="encrypt.html">Encrypt</a>
      <a href="decrypt.html">Decrypt</a>
    </nav>
    <a href="login.html">Log Out</a>
  </header>
  <div class="container">
    <h1>AES IMAGE ENCRYPTION SYSTEM</h1>
    <h2>File Decryptor</h2>
    <form>
      <label for="encrypted-file">Select an encrypted file to decrypt:</label>
      <input type="file" id="encrypted-file" accept=".enc">
      <label for="password">Enter the decryption password:</label>
      <input type="password" id="password">
      <button id="decrypt-btn">Decrypt</button>
      <p class="error" id="error"></p>
    </form>
  </div>
  <script>
    const decryptBtn = document.getElementById('decrypt-btn');
    const encryptedFileInput = document.getElementById('encrypted-file');
    const passwordInput = document.getElementById('password');
    const errorElem = document.getElementById('error');

    async function Decryptbtn() {
      decryptBtn.addEventListener('click', () => {
        // Validate that a file and password have been provided
        if (!encryptedFileInput.value) {
          showError('Please select an encrypted file to decrypt.');
          return;
        }
        if (!passwordInput.value) {
          showError('Please enter the decryption password.');
          return;
        }

        // Decrypt the file using the backend API
        async function Decrypt_api() {
          const encrypted_File = encryptedFileInput.files[0];
          const form_Data = new FormData();
          formData.append('file', encryptedFile);
          formData.append('password', passwordInput.value);
          const response1 = await fetch('/decrypt_api', {
            method: 'POST',
            body: formData
          });
          if (!response.ok) {
            showError('Failed to decrypt file.');
            return;
          }
        };
        async function Decrypt_api_display() {
          // Display the decrypted file to the user
          const encryptedFile = encryptedFileInput.files[0];
          const formData = new FormData();
          formData.append('file', encryptedFile);
          formData.append('password', passwordInput.value);
          const response = await fetch('/decrypt', {
            method: 'POST',
            body: formData
          });
          if (!response.ok) {
            showError('Failed to decrypt file.');
            return;
          }
        }
      });
    };

    function showError(errorMessage) {
      errorElem.innerText = errorMessage;
    }
  </script>
</body>

</html>